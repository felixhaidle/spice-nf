process GENERATE_LIBRARY {
    memory '2 GB'  // Set a default memory value
    cpus '1'
    conda './environment.yml'
    input:
        val species          // String: Species name
        val release         // Integer: Ensembl release version
        path anno_tools         // Path: Path to annotation tools file
        val outdir             // Path: Output directory
        val test_mode       // Boolean: Whether to run in test mode


    output:
        path "library/spice_lib_*", emit: library_ch // Declare the generated directory as output


    publishDir "${outdir}", mode: 'copy'

    script:
    """
    mkdir -p library  

    
    python ${projectDir}/tools/SPICE/spice_library.py \
        --outdir library \
        --species '${species}' \
        --release '${release}' \
        --test 
        
    """
}


process FAS_ANNOTATION {
    executor 'slurm'
    cpus '16'
    conda './environment.yml'
    input:
        path anno_tools         // Path: Path to annotation tools file
        path spice_library_dir   // Path: Library generated by spice_library.py
        val test_mode           // Boolean: Whether to run in test mode


    output:
        path "${outdir}/library", emit: library_ch // Declare the generated directory as output


    publishDir "${outdir}/library", mode: 'copy'

    script:
    """
    mkdir -p ${outdir}/library  

    
    fas.doAnno \
        -i "${spice_library_dir}/transcript_data/transcript_set.fasta" \
        -o "${spice_library_dir}/fas_data/" \
        -t ${annotools} \
        -n annotations \
        --cpus ${task.cpus} \
        
    """
}
